#分配属性值，级联，继承
---

[原文](http://www.w3.org/TR/CSS2/cascade.html)

[翻译参考这里](http://www.cnblogs.com/-Milo/archive/2010/12/23/2873635.html)

**级联(Cascading)**：事实上,级联样式之所以被描述为级联,是因为它们可以在内容的不同层次上实现,并且它们优先于更高层次上定义的结构.

##1.  指定值，计算值和真实值

 一旦浏览器解析某个文档并生成了一个文档树，它会为文档树中的每个元素的每个属性分配一个值来应用到目标媒体类型上。

一个属性的最终值分四个步骤来计算：首先该值通过规范来指定（指定值），然后将其转换为一个用来继承的值（计算值），如果需要还会将其转变为一个绝对值（使用值），最后将根据本地环境的相关因素转换为最终值（真实值）

###1.1 指定值

首先，浏览器会根据下面几个机制为每个属性分配指定值（特殊性按先后顺序）：

1. 如果级联的结果是一个值，那么就使用这个值作为指定值。

1. 另外，如果一个元素的某个属性是继承过来的且这个元素不是文档树的根元素，那么就使用其父元素的计算值作为指定值。
 
1. 否则就使用该属性的初始值作为指定值。每个属性的初始值都会在属性定义时指定。

###1.2 计算值

在级联过程下，指定值由计算值决定；例如绝对URIs的'em' 和 'ex'单位将被计算成像素或者绝对长度。计算一个值不需要浏览器渲染文档。

浏览器不能解决的绝对URIs的计算值就是其指定值。

当某个属性的指定值不是继承自其祖先元素时，它的计算值将取决于该属性定义中关于计算值的相关说明。当指定值继承自其祖先元素，请查阅这章inheritance中关于计算值的定义。

就像'Applies To'中定义的那样，即使某个属性没有应用到元素上，它的计算值依然存在。然而，一些属性可能会根据某属性是否应用到某元素上来定义这个属性的计算值。

###1.3 使用值

计算值是尽可能在文档没有格式化之前进行处理的。然而一些值只能在文档布局时来决定。例如，如果一个元素的宽度设置为其包含块的某个百分比，那么在其包含块的宽度没有决定之前，它的宽度也是决定不了的。使用值就是结合计算值和解析的其他相关因素所转换出来的一个绝对值

###1.4 真实值

一般使用值就是渲染页面所用的值，但是一个浏览器可能在给定的环境中不能够使用这个值。例如，浏览器在只能够使用整数格式的像素宽度来渲染边框，因此可能会取非整数计算值的近似值，或者，浏览器可能会强制使用黑色或者白色来替代全色。真实值就是某些经过近似计算的应用值。

##2. 继承

就像上面描述的，在文档树中，一个元素的子元素将会继承其父元素的一些属性值。每个属性都会定义其是否可以被继承。

假设有一个内部含有EM元素的H1元素： 

	<H1>The headline <EM>is</EM> important!</H1>

如果EM元素没有指定颜色，该元素将继承其父元素的颜色值，因此如果H1元素的颜色是蓝色，那么EM元素的颜色也为蓝色。

当发生继承时，元素将继承计算值。父元素的计算值将成为其子元素的指定值及计算值。

例如，给出下面的样式：

	style:
	body { font-size: 10pt }
	h1 { font-size: 130% }
	
	document:
	<BODY>
	  <H1>A <EM>large</EM> heading</H1>
	</BODY>

H1元素的'font-size'属性的计算值是'13pt'(130% 乘以 10pt, 10pt是其父元素的字体大小)。因为'font-size'得计算值被继承了，所以EM元素的计算值也是'13pt'。如果浏览器认为13pt无效，那么'font-size'的H1和EM元素的真实值可能是其他值，例如'12pt'。

注意文档树中的继承将不会被匿名盒子截断。

##3. @import规则

'@import'允许用户从其他样式文件中导入样式。在CSS2.1中， @import规则应该在任何其他规则之前（除了@charset规则）。对于浏览器忽略@import的情况，请查看section on parsing。'@import'关键字后面必须跟随包含样式文件的URI。允许使用字符串；此时浏览器将其当做url(...)形式（括号内为字符串）。

##4. 级联

样式表有三个来源：作者，用户和浏览器。

- 作者：作者会根据文档语言的相关约定为源文档指定样式。例如，在HTML中，样式可以包含在文档内部或者外部样式文件中。

- 用户：用户可以为某个特定的文档指定样式信息。比如通过浏览设置文本字体尺寸。

- 浏览器：标准浏览器都会有一个默认的样式。一个浏览器的默认样式应该使其文档中元素的表现符合该文档语言的一般描述。（举例来说，对于可视化浏览器,HTML中的EM元素字体表现为斜体）。对于HTML文档的标准默认样式，请查看A sample style sheet for HTML 。

这三个来源的样式将会发生重叠，它们根据级联关系互相影响。

CSS级联为每一个样式规则分配一个权值。当同时应用几条规则时，权值越大特殊性越高。

默认情况下，作者定义的样式权值高于用户定义的。然而，当应用"!important"规则是，特殊性顺序会颠倒。所有用户和作者定义的样式权值都高浏览器的默认样式。

###4.1 级联顺序

浏览器按照以下顺序来查找某个组合元素或属性的值：

对于目标媒体类型，查找相关元素和属性上的所有声明。
根据重要性（普通的和重要）和来源（作者，用户或浏览器）进行排序。特殊性按照升序顺序排列：

- 浏览器声明

- 用户普通声明

- 作者普通声明

- 作者重要声明

- 用户重要声明

有相同重要性和来源的规则按照选择器的特殊性来排序:特殊性高的选择器会覆盖普通选择器。伪元素和伪类分别被当做普通元素和普通类。
最后，按照指定顺序排序：如果两个声明有相同的权值，来源和特异性，最晚定义的声明有效。导入的样式被认为在当前文件的所有样式声明之前。

###4.2 !important规则

CSS试图使作者样式和用户样式之间能够相互平衡。默认情况下，作者的样式会覆盖用户样式（查看级联规则3）。 

然而，一个带有"!important"声明的特殊性要高于普通的声明。作者和用户的声明都可以使用"!important"，用户的"!important"声明会覆盖作者的"!important"声明。这个CSS特性改善了文档的易用性，有某些特殊要求（大的字体，组合颜色，等等）的用户也可以通过这个特性来控制某个元素的外观。

###4.3 计算选择器的特殊性

一个选择器的特殊性按照下面的方式来计算：


如果一个声明来自style而不是选择器，将其计算为1，其他情况计算为0（=a）（在HTML中，元素style属性的值为该元素样式规则。这些规则没有选择器，因此 a=1, b=0, c=0, d=0）。

计算选择器中ID的个数（=b）

计算选择器中除ID外的其他属性和伪类的个数（=c）

计算选择器中的元素名称及伪元素的个数（=d）。

特殊性s = (a,b,c,d)

不同的s之间按位比较，较大的s具有较高的特殊性。

对于特殊性相同的样式，通过以下规则判断其权重：

1.有!important的权重高于无!important的；

2.创作人员样式高于浏览器默认样式；

3.按照出现顺序排列，排在后面的权重高于排在前面的；

4.导入的样式排在前，主样式表中的样式排在后；

###4.4 非CSS隐式呈现属性的优先级

在HTML源文档中，浏览器可能会选择优先呈现一些属性。此时，这些属性将被转换为相应特殊性为0的CSS规则，并且被当做好像插入到了作者样式的起始位置。这些规则可能会被后面的规则所覆盖。在转换阶段，这个策略使这些格式的属性与样式表更容易共存。

比如b元素自带宽体加黑样式。